{"componentChunkName":"component---src-templates-blog-post-js","path":"/deploy-gatsby-by-github-action/","result":{"data":{"site":{"siteMetadata":{"title":"kevin wang's blog"}},"markdownRemark":{"id":"c5b2deff-7bc9-5e4c-afe0-0cb25cdd2900","excerpt":"本文會提到 設定 Github Action   透過 Github Action 發佈 Gatsby Project到 GitHub Page   前言 在 Github Action 推出前， Github最常搭配的CI服務很常是Travis CI， 相信大家有在Github看開源專案的時候， 看過有些reamd…","html":"<h2>本文會提到</h2>\n<ol>\n<li>設定 Github Action  </li>\n<li>透過 Github Action 發佈 Gatsby Project到 GitHub Page  </li>\n</ol>\n<h2>前言</h2>\n<p>在 Github Action 推出前，<br>\nGithub最常搭配的CI服務很常是Travis CI，<br>\n相信大家有在Github看開源專案的時候，<br>\n看過有些reamd上的 <strong>build pass</strong> 小貼紙，<br>\n通常都是Travis CI的。\n在近期的Github + Travis CI實際串接中，<br>\n發現 Github Action 比剛出的時候似乎改了不少，<br>\n想想編譯部落格不太需要繞一圈去搭配一個額外的CI/CD服務，<br>\n所以決定試試實際串接Github Action。  </p>\n<h2>前置準備</h2>\n<ol>\n<li>一個Github帳號  </li>\n<li>一個在Github上要佈署的專案  </li>\n</ol>\n<p>接下來是先確認 <a href=\"https://github.com/features/actions#pricing-details\">Pricing</a>  </p>\n<p>目前GitHub Action很佛心的提供Open Source Project的免費使用，<br>\n更佛心的點是相比Travis CI，<br>\nGitHub Action Free Plan直接提供了每個月2000分鐘的使用時間，<br>\n還提供了 GitHub Action Marketplace，<br>\n可以直接使用或是修改成你要的Action。</p>\n<h2>設定</h2>\n<h3>新增 perrsonal sccess token</h3>\n<p>首先要新增 perrsonal sccess token，<br>\n到 GitHub的 Settings/Developer/settings/Personal access tokens 下產生一組新的token，<br>\nNote 打一組自己會記得的，<br>\n如果是public repo的話選 <strong>public_repo</strong>，<br>\n如果是private repo的話要選整個repo權限，<br>\n記得產生完要記錄起來。  </p>\n<h3>設定 Secrets</h3>\n<p>到要自動發佈GitHub repo，<br>\n到 Settings/Secrets 新增一組New Secret，  </p>\n<p>Name:打自己看得懂意思的就好，等等會用到<br>\nValue:要填上剛剛產生的token  </p>\n<h2>新增Action</h2>\n<p>接著到要發佈repo的Action頁，<br>\n這裡我選擇套用<a href=\"https://github.com/peaceiris/actions-gh-pages\">寫好的GitHub Action</a>試試效果。</p>\n<p>首先要先建立一個 .yml檔案，<br>\n根據 <a href=\"https://docs.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow#creating-a-workflow-file\">文件</a> 要放在以下位置</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n└── .github\n    ├── workflows\n    └── your-workflow.yml(.yaml 也可以)</code></pre></div>\n<p>參考以下設定</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">personal_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.剛剛設定的SecretName <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">external_repository</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>username<span class=\"token punctuation\">}</span>/<span class=\"token punctuation\">{</span>username<span class=\"token punctuation\">}</span>.github.io <span class=\"token comment\"># 發佈到github page 所在 repo </span>\n          <span class=\"token key atrule\">publish_branch</span><span class=\"token punctuation\">:</span> master\n          <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public</code></pre></div>\n<p>都設定正確的話，<br>\n當master有新的push的時候，<br>\n就會自動跑設定好的GitHub Action，<br>\n就可以自動完成佈屬任務了。  </p>\n<p>ref:</p>\n<ol>\n<li><a href=\"https://docs.github.com/en/actions\">https://docs.github.com/en/actions</a></li>\n</ol>","frontmatter":{"title":"透過 Github Action 將 Gatsby 佈數到 GitHub Page","date":"August 23, 2020","description":"Github Action study note"}}},"pageContext":{"slug":"/deploy-gatsby-by-github-action/","previous":{"fields":{"slug":"/deploy-gatsby-blog-note/"},"frontmatter":{"title":"佈署Gatsby專案到Github Page"}},"next":null}},"staticQueryHashes":["1146911855","3000541721"]}