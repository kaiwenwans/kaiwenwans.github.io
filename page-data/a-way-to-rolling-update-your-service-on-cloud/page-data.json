{"componentChunkName":"component---src-templates-blog-post-js","path":"/a-way-to-rolling-update-your-service-on-cloud/","result":{"data":{"site":{"siteMetadata":{"title":"kevin wang's blog"}},"markdownRemark":{"id":"957a5110-e097-54ad-b281-fdb2f46dc51a","excerpt":"傳統的部屬方案 一個軟體服務在線上都有機會面臨到需要升級的時候， 一般傳統的軟體升級方式可能是這樣的，   traditional-continue-deploy.svg Artifact…","html":"<h2>傳統的部屬方案</h2>\n<p>一個軟體服務在線上都有機會面臨到需要升級的時候，<br>\n一般傳統的軟體升級方式可能是這樣的，  </p>\n<p><img src=\"/e381376d52ab380332da4ca447d0fe21/traditional-continue-deploy.svg\" alt=\"traditional-continue-deploy.svg\"></p>\n<blockquote>\n<p>Artifact 是可用於部屬的包</p>\n</blockquote>\n<p>這樣的升級方式會面臨幾個情形，  </p>\n<ul>\n<li>升級服務期間會造成服務短暫中斷</li>\n<li>服務如果需要退版的時候需要重新準備降版</li>\n</ul>\n<h2>不下線的滾動升級方案</h2>\n<p>要讓一個服務可以在不下線的情況下完成升級，<br>\n需要幾個準備:</p>\n<ol>\n<li>準備一個新版本的服務</li>\n<li>檢查新部屬的服務是否正常</li>\n<li>將流量導向新的服務</li>\n<li>如果新的服務沒問題的話關閉舊服務</li>\n<li>反之新服務有問題需退版則流量導回舊服務</li>\n</ol>\n<p>實際的實作大略如底下的圖</p>\n<p><img src=\"/c22ef22fb8ab8db22a40350806440f7b/rolling-update-deploy.svg\" alt=\"rolling-update-deploy.svg\"></p>\n<blockquote>\n<p>Health Check Service 是用來檢查服務是否健康的服務</p>\n</blockquote>\n<blockquote>\n<p>Artifact Server 是用來提供 download artifact 的服務</p>\n</blockquote>\n<blockquote>\n<p>Provisioning 是指一個服務從無到準備到可上線的過程</p>\n</blockquote>\n<ol>\n<li>Health check 服務持續檢查 Instance 是否正常，在這裡提到的 Instance 可能是一台 Server，或是機器上的一個預備服務</li>\n<li>由即將負責服務線上的 Instance 發起一個請求從 Artifact Server 取得 Artifact。</li>\n<li>在取得 Artifact 以後做完後續服務部屬的準備</li>\n<li>部屬完成後，Health Check API 會改成回應服務正常</li>\n<li>當服務正常以後，將流量切換到新準備的 Instance</li>\n</ol>\n<p>其中步驟 2 以及步驟 3通常是從 Instance 中執行一個 Script 來完成的</p>\n<p>如果用 AWS 來實作的話，<br>\n大致的實作流程如下</p>\n<p><img src=\"/69dff987c9dbcf8a34a3c52470efb398/rolling-update-deploy-ec2.svg\" alt=\"rolling-update-deploy-ec2.svg\"></p>\n<blockquote>\n<p>EC2 Instance 是 AWS 上的機器實例</p>\n</blockquote>\n<blockquote>\n<p>Target Group 是用來定義一群目標變成一個群組，可以讓 Load balancer 將流量導入</p>\n</blockquote>\n<ol>\n<li>將 EC2 Instance 掛載在 Target Group 上</li>\n<li>Target Group 會開始進行 Health check 檢查</li>\n<li>EC2 Instance 會從 Artifact server 取得 Artifact</li>\n<li>EC2 Instance 開始進行服務上線準備</li>\n<li>Target Group 會持續呼叫指定的 Health Check endpoint</li>\n<li>如果 Target Group 回應成功則可以 Load balancer 換上新的 Target Group。</li>\n</ol>","frontmatter":{"title":"雲端服務滾動升級的一種思路","date":"April 30, 2021","description":"a-way-to-rolling-update-your-service-on-cloud"}}},"pageContext":{"slug":"/a-way-to-rolling-update-your-service-on-cloud/","previous":{"fields":{"slug":"/learn-how-gatsby-query-data-from-graphql/"},"frontmatter":{"title":"透過 GraphQL 在 Gatsby 中做資料撈取"}},"next":null}},"staticQueryHashes":["3000541721","3274528899"]}